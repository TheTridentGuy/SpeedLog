<!DOCTYPE html>
<html lang="en">
<head>
    <!--
    SpeedLog
    Copyright (C) 2024  TheTridentGuy

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpeedLog</title>
    <style>
        body, html {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
        }
        * {
            font-family: sans-serif;
        }
        .flexrow {
            display: flex;
            flex-direction: row;
            align-items: center;
            max-width: 100%;
        }
        .flexrowitem {
            flex-grow: 1;
            padding: 1vmin;
            max-width: 12vw;
            margin: 1vmin;
        }
        .flexrowitemfull {
            flex-grow: 1;
            padding: 1vmin;
            margin: 1vmin;
        }
        .singledisplay {
            text-align: center;
            height: 12vw;
            width: 100%;
            font-size: 12vw;
        }
        .singledisplaysmall {
            text-align: center;
            height: 12vw;
            width: 100%;
            font-size: 2vw;
        }
        .pad {
            flex-grow: 100;
        }
        .phonetic {
            display: inline-block;
            font-size: 3vw;
            padding: 1vmin;
            width: 100%;
            text-align: center;
        }
        #date {
            font-size: larger;
        }
        .flexcol {
            display: flex;
            flex-direction: column;
        }
        .flexcolitem {
            flex-grow: 1;
            height: 100%;
        }
        #confirm {
            position: sticky;
            bottom: 0;
        }
        .menulink {
            background-color: #777;
            border-radius: 10px;
            border: none;
            padding: 1vmin;
            color: #ddd;
            text-decoration: none;
        }
        .menulink:hover {
            background-color: #555;
        }
        h1 {
            margin: 0;
            position: absolute;
            top: 0px;
            right: 0px;
        }
        .icon svg, .icon img {
            height: 1em;
            width: 1em;
            fill: currentColor;
        }
        .icon.baseline svg, .icon img {
            top: .125em;
            position: relative;
        }
        a div {
            display: inline;
        }
    </style>
</head>
<body onclick="if(ignoreclickflag){ignoreclickflag=false}else{ignorekey=false}">
    <h1>
        <a href="/" class="menulink"><div class="icon baseline"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M362.7 19.3L314.3 67.7 444.3 197.7l48.4-48.4c25-25 25-65.5 0-90.5L453.3 19.3c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2C-1.5 489.7 .8 498.8 7 505s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L421.7 220.3 291.7 90.3z"/></svg></div></a>
        <a href="/view" class="menulink"><div class="icon baseline"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM144 256a144 144 0 1 1 288 0 144 144 0 1 1 -288 0zm144-64c0 35.3-28.7 64-64 64c-7.1 0-13.9-1.2-20.3-3.3c-5.5-1.8-11.9 1.6-11.7 7.4c.3 6.9 1.3 13.8 3.2 20.7c13.7 51.2 66.4 81.6 117.6 67.9s81.6-66.4 67.9-117.6c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3z"/></svg></div></a>
        <a href="/logout" class="menulink"><div class="icon baseline"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M502.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 224 192 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l210.7 0-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l128-128zM160 96c17.7 0 32-14.3 32-32s-14.3-32-32-32L96 32C43 32 0 75 0 128L0 384c0 53 43 96 96 96l64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0c-17.7 0-32-14.3-32-32l0-256c0-17.7 14.3-32 32-32l64 0z"/></svg></div></a>
    </h1>
    <h2>Callsign (type to enter):</h2>
    <div class="flexrow">
        <div class="pad"></div>
        <div class="flexrowitem" id="csfocus">
            <div class="singledisplay">></div>
        </div>
        <div class="flexrowitem">
            <div class="singledisplay" id="display1">_</div>
            <span class="phonetic" id="phonetic1">-</span>
        </div>
        <div class="flexrowitem">
            <div class="singledisplay" id="display2">_</div>
            <span class="phonetic" id="phonetic2">-</span>
        </div>
        <div class="flexrowitem">
            <div class="singledisplay" id="display3">_</div>
            <span class="phonetic" id="phonetic3">-</span>
        </div>
        <div class="flexrowitem">
            <div class="singledisplay" id="display4">_</div>
            <span class="phonetic" id="phonetic4">-</span>
        </div>
        <div class="flexrowitem">
            <div class="singledisplay" id="display5">_</div>
            <span class="phonetic" id="phonetic5">-</span>
        </div>
        <div class="flexrowitem">
            <div class="singledisplay" id="display6">_</div>
            <span class="phonetic" id="phonetic6">-</span>
        </div>
        <div class="pad"></div>
    </div>
    <h2>Frequency (type to enter):</h2>
    <div class="flexrow">
        <div class="pad"></div>
        <div class="flexrowitem" id="frqfocus">
            <div class="singledisplaysmall">ENTER to finish field and move to frequency</div>
        </div>
        <div class="flexrowitem">
            <div class="singledisplay" id="frqdisplay1">_</div>
        </div>
        <div class="flexrowitem">
            <div class="singledisplay" id="frqdisplay2">_</div>
        </div>
        <div class="flexrowitem">
            <div class="singledisplay" id="frqdisplay3">_</div>
        </div>
        <div class="flexrowitem">
            <div class="singledisplay">.</div>
        </div>
        <div class="flexrowitem">
            <div class="singledisplay" id="frqdisplay4">_</div>
        </div>
        <div class="flexrowitem">
            <div class="singledisplay" id="frqdisplay5">_</div>
        </div>
        <div class="flexrowitem">
            <div class="singledisplay" id="frqdisplay6">_</div>
        </div>
        <div class="flexrowitem">
            <label for="mhz">MHz</label>
            <input type="radio" name="unit" id="mhz" checked>
            <label for="khz">kHz</label>
            <input type="radio" name="unit" id="khz">
        </div>
        <div class="pad"></div>
    </div>
    <h2>Date:</h2>
    <div class="flexrow">
        <input class="flexrowitemfull" type="datetime-local" name="date" id="date" onchange="autosetdate=false" onfocus="ignorekey=true;ignoreclickflag=true">
    </div>
    <h2>Notes:</h2>
    <div class="flexrow">
        <textarea name="notes" id="notes" class="flexrowitemfull" onfocus="ignorekey=true;ignoreclickflag=true"></textarea>
    </div>
    <div class="flexrow" id="confirm">
        <h3 class="flexrowitemfull" id="msg"></h3>
    </div>
    <span>Made with &lt;3 by TheTridentGuy - <a href="/about">More Info</a></span>
    <script>
        phonetic = {
            "A": "Alpha",
            "B": "Bravo",
            "C": "Charlie",
            "D": "Delta",
            "E": "Echo",
            "F": "Foxtrot",
            "G": "Golf",
            "H": "Hotel",
            "I": "India",
            "J": "Juliet",
            "K": "Kilo",
            "L": "Lima",
            "M": "Mike",
            "N": "November",
            "O": "Oscar",
            "P": "Papa",
            "Q": "Quebec",
            "R": "Romeo",
            "S": "Sierra",
            "T": "Tango",
            "U": "Uniform",
            "V": "Victor",
            "W": "Whiskey",
            "X": "X-ray",
            "Y": "Yankee",
            "Z": "Zulu",
            "1": "One",
            "2": "Two",
            "3": "Three",
            "4": "Four",
            "5": "Five",
            "6": "Six",
            "7": "Seven",
            "8": "Eight",
            "9": "Nine",
            "0": "Zero"
        }

        function $(id){
            return document.getElementById(id)
        }

        focusindex = 0
        csindex = 1
        frqindex = 1
        shift = false
        autosetdate = true
        ignorekey = false
        ignoreclickflag = false
        msg = ""

        $("notes").value = ""
        document.addEventListener("keydown", onkeydown)
        document.addEventListener("keyup", onkeyup)
        function onkeydown(e){
            if(ignorekey){
                return
            }
            key = e.key
            if(key == "SHIFT"){
                shift = true
            }else if(focusindex == 0){
                cskeyevent(e)
            }else if(focusindex == 1){
                frqkeyevent(e)
            }else if(focusindex == 2){
                confirmkeyevent(e)
            }
        }
        function onkeyup(e){
            if(e.key == "Shift"){
                shift = false
            }
        }
        function cskeyevent(e){
            key = e.key
            key = key.toLocaleUpperCase()
            if(autosetdate && csindex == 1){
                document.getElementById("date").valueAsDate = new Date()
            }
            if(((65 <= key.charCodeAt(0) && key.charCodeAt(0) <= 90) || (48 <= key.charCodeAt(0) && key.charCodeAt(0) <= 57)) && csindex <= 6 && key.length == 1){
                $("display" + csindex).innerHTML = key
                $("phonetic" + csindex).innerHTML = phonetic[key]
                csindex += 1
                if(csindex > 6) {
                    incrementfocus()
                }
            }else if(key == "BACKSPACE" && csindex > 1) {
                $("display" + (csindex-1)).innerHTML = "_"
                $("phonetic" + (csindex-1)).innerHTML = "-"
                csindex -= 1
            }else if(key == "ENTER"){
                incrementfocus()
            }else{
                return
            }
        }
        function frqkeyevent(e){
            key = e.key
            key = key.toLocaleUpperCase()
            if(48 <= key.charCodeAt(0) && key.charCodeAt(0) <= 57 && frqindex <= 6 && key.length == 1){
                $("frqdisplay" + frqindex).innerHTML = key
                frqindex += 1
            }else if(key == "BACKSPACE" && frqindex > 1) {
                $("frqdisplay" + (frqindex-1)).innerHTML = "_"
                frqindex -= 1
            }else if(key == "BACKSPACE" && frqindex <= 1){
                decrementfocus()
            }else if(key == "ENTER"){
                incrementfocus()
            }else{
                return
            }
        }
        function confirmkeyevent(e){
            key = e.key
            key = key.toLocaleUpperCase()
            if(key == "BACKSPACE"){
                decrementfocus()
            }else if(key == "ENTER"){
                sendlog()
                clearall()
            }else{
                return
            }
        }
        function incrementfocus(){
            focusindex += 1
            updatefocus()
        }
        function decrementfocus(){
            focusindex -= 1
            updatefocus()
        }
        function updatefocus(){
            switch(focusindex){
                case 0:
                    $("csfocus").innerHTML = `<div class="singledisplay">></div>`
                    $("frqfocus").innerHTML = `<div class="singledisplaysmall">ENTER to finish field and move to frequency</div>`          
                    $("msg").innerHTML = msg
                    break
                case 1:
                    $("csfocus").innerHTML = `<div class="singledisplaysmall">BACKSPACE to clear charachter, or edit callsign if frequency is empty</div>`
                    $("frqfocus").innerHTML = `<div class="singledisplay">></div>`          
                    $("msg").innerHTML = msg
                    break
                case 2:
                    $("csfocus").innerHTML = `<div class="singledisplaysmall">BACKSPACE to clear charachter, or edit callsign if frequency is empty</div>`
                    $("frqfocus").innerHTML = `<div class="singledisplaysmall">BACKSPACE to return to editing frequency</div>`          
                    $("msg").innerHTML = "Press ENTER again to submit log"
                    break
            }
        }
        function sendlog(){
            var callsign = ""
            for(var i=1; i<=6; i++){
                callsign += $("display"+i).innerHTML
            }
            var frq = ""
            for(var i=1; i<=6; i++){
                frq += $("frqdisplay"+i).innerHTML
                if(i == 3){frq += "."}
            }
            var datetime = $("date").valueAsDate.toLocaleString()
            var notes = $("notes").value
            var unit = ($("mhz").checked)?"MHz":"kHz"
            var data = JSON.stringify({
                "callsign": callsign,
                "frequency": frq,
                "unit": unit,
                "date": datetime,
                "notes": notes
            })
            console.log(data)
            xhr = new XMLHttpRequest()
            xhr.open("GET", "/log?log="+data, true)
            xhr.send()
            msg = "Log Submitted Successfully"
            $("msg").innerHTML = msg
        }
        function clearall(){
            ignorekey = false
            var fakeevent = {}
            fakeevent.key = "backspace"
            for(var i=0; i<15; i++){
                onkeydown(fakeevent)
            }
            $("notes").value = ""
        }
    </script>
</body>
</html>
